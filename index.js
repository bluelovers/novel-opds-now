"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = __importDefault(require("express"));
const child_process_1 = require("child_process");
const path_1 = require("path");
const file_1 = __importDefault(require("./server/file"));
const __root_1 = __importDefault(require("./lib/__root"));
const setup_1 = require("./server/gun/setup");
const app = express_1.default();
console.log(`build cache`);
child_process_1.spawnSync('node', [
    path_1.join(__root_1.default, `./cli/cache.js`),
], {
    stdio: 'inherit',
});
app.use('/file', file_1.default());
app.use('/*', (req, res, next) => {
    console.log(req.baseUrl, req.url, req.params);
    next();
});
app.use('/*', (req, res) => res.end('Welcome to micro'));
setup_1.setupGun(app);
console.log(`server setup ready`);
exports.default = app;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUlBLHNEQUE4QjtBQUU5QixpREFBMEM7QUFFMUMsK0JBQXNDO0FBTXRDLHlEQUF3QztBQUN4QywwREFBa0M7QUFFbEMsOENBQThDO0FBRTlDLE1BQU0sR0FBRyxHQUFHLGlCQUFPLEVBQUUsQ0FBQztBQUV0QixPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQzNCLHlCQUFTLENBQUMsTUFBTSxFQUFFO0lBQ2pCLFdBQUksQ0FBQyxnQkFBTSxFQUFFLGdCQUFnQixDQUFDO0NBQzlCLEVBQUU7SUFDRixLQUFLLEVBQUUsU0FBUztDQUNoQixDQUFDLENBQUM7QUFFSCxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxjQUFXLEVBQUUsQ0FBQyxDQUFDO0FBRWhDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRTtJQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDOUMsSUFBSSxFQUFFLENBQUM7QUFDUixDQUFDLENBQUMsQ0FBQztBQUVILEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7QUFFekQsZ0JBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUVkLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUNsQyxrQkFBZSxHQUFHLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgdXNlciBvbiAyMDIwLzEvMjguXG4gKi9cbmltcG9ydCBtaWNybywgeyBSZXF1ZXN0SGFuZGxlciwgYnVmZmVyLCB0ZXh0LCBqc29uIH0gZnJvbSAnbWljcm8nO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBFbnVtTm92ZWxTaXRlTGlzdCB9IGZyb20gJ25vdmVsLWRvd25sb2FkZXIvc3JjL2FsbCc7XG5pbXBvcnQgeyBzcGF3blN5bmMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCB7IHJlYWRKU09OLCByZWFkSlNPTlN5bmMsIHJlYWRGaWxlLCByZW1vdmUsIHdyaXRlSlNPTiB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCB7IGpvaW4sIGJhc2VuYW1lIH0gZnJvbSBcInBhdGhcIjtcbmltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBJQ2FjaGVNYXAgfSBmcm9tICcuL2xpYi90eXBlcyc7XG5pbXBvcnQgeyBQYXNzVGhyb3VnaCB9IGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQgeyBmcm9tQnVmZmVyIH0gZnJvbSAnZmlsZS10eXBlJztcbmltcG9ydCB7IF9fY2FjaGVNYXBGaWxlIH0gZnJvbSAnLi9saWIvY29uc3QnO1xuaW1wb3J0IGZpbGVIYW5kbGVyIGZyb20gJy4vc2VydmVyL2ZpbGUnO1xuaW1wb3J0IF9fcm9vdCBmcm9tICcuL2xpYi9fX3Jvb3QnO1xuaW1wb3J0IEd1biBmcm9tICdndW4nO1xuaW1wb3J0IHsgc2V0dXBHdW4gfSBmcm9tICcuL3NlcnZlci9ndW4vc2V0dXAnO1xuXG5jb25zdCBhcHAgPSBleHByZXNzKCk7XG5cbmNvbnNvbGUubG9nKGBidWlsZCBjYWNoZWApO1xuc3Bhd25TeW5jKCdub2RlJywgW1xuXHRqb2luKF9fcm9vdCwgYC4vY2xpL2NhY2hlLmpzYCksXG5dLCB7XG5cdHN0ZGlvOiAnaW5oZXJpdCcsXG59KTtcblxuYXBwLnVzZSgnL2ZpbGUnLCBmaWxlSGFuZGxlcigpKTtcblxuYXBwLnVzZSgnLyonLCAocmVxLCByZXMsIG5leHQpID0+IHtcblx0Y29uc29sZS5sb2cocmVxLmJhc2VVcmwsIHJlcS51cmwsIHJlcS5wYXJhbXMpO1xuXHRuZXh0KCk7XG59KTtcblxuYXBwLnVzZSgnLyonLCAocmVxLCByZXMpID0+IHJlcy5lbmQoJ1dlbGNvbWUgdG8gbWljcm8nKSk7XG5cbnNldHVwR3VuKGFwcCk7XG5cbmNvbnNvbGUubG9nKGBzZXJ2ZXIgc2V0dXAgcmVhZHlgKTtcbmV4cG9ydCBkZWZhdWx0IGFwcFxuIl19